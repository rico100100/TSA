<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>TSA · Índice publicado</title>
  <meta name="description" content="Índice del repositorio TSA con enlaces directos a la versión publicada (GitHub Pages) y accesos rápidos a GitHub.">
  <style>
    :root{
      --bg-0:#0e0a0a; --bg-1:#140d0e; --bg-2:#1c1011;
      --card:#1f1214; --ink:#f6eaea; --muted:#d7b9b9;
      --accent:#b3001b; --accent-2:#7a0012; --accent-3:#ff4d4d;
      --ring: rgba(255,77,77,.35);
      --shadow: 0 12px 28px rgba(0,0,0,.48), 0 2px 6px rgba(179,0,27,.25);
      --radius: 18px; --radius-sm: 12px;
      --gap: 14px; --gap-lg: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 10% -10%, rgba(179,0,27,.25), transparent 65%),
        radial-gradient(1000px 600px at 100% 0%, rgba(122,0,18,.25), transparent 60%),
        linear-gradient(180deg,var(--bg-0),var(--bg-2));
      background-attachment: fixed;
    }
    header{ position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.2) blur(6px);
      background:linear-gradient(180deg, rgba(20,13,14,.85), rgba(20,13,14,.65));
      border-bottom:1px solid rgba(255,77,77,.15);
    }
    .wrap{max-width:1200px; margin-inline:auto; padding: clamp(14px, 2vw, 20px);}
    .title{display:flex; align-items:center; gap:14px; flex-wrap:wrap;}
    .badge{font:600 12px/1 var(--sans); letter-spacing:.06em; text-transform:uppercase;
      color:#fff; background:linear-gradient(180deg,var(--accent),var(--accent-2));
      padding:8px 10px; border-radius:999px; box-shadow: var(--shadow);}
    h1{margin:0; font-size: clamp(22px, 3.5vw, 34px); letter-spacing:.3px; text-shadow: 0 1px 0 rgba(0,0,0,.4);}
    .sub{ margin:.35rem 0 0 0; color:var(--muted); font-size: clamp(13px,1.8vw,15px);}
    .controls{ display:grid; grid-template-columns: 1fr; gap: var(--gap); margin-top:12px;}
    .search{ display:flex; gap:10px; align-items:center; background:var(--card); border:1px solid rgba(255,77,77,.18);
      border-radius:999px; padding:10px 14px; box-shadow: var(--shadow);}
    .search input{flex:1; background:transparent; border:0; outline:0; color:var(--ink); font-size:16px; padding:6px;}
    .filters{ display:flex; flex-wrap:wrap; gap:10px;}
    .chip{ background:linear-gradient(180deg,#251316,#1b0f10); border:1px solid rgba(255,77,77,.18);
      color:var(--muted); padding:8px 12px; border-radius:999px; cursor:pointer; user-select:none;
      transition:transform .12s ease, box-shadow .2s ease, border-color .2s ease;}
    .chip[data-active="true"]{ color:#fff; border-color: var(--accent-3); box-shadow: 0 0 0 3px var(--ring), var(--shadow);}
    .stats{ display:flex; gap:14px; flex-wrap:wrap; align-items:center; color:var(--muted); font: 500 13px/1.6 var(--sans);}
    main{ padding: clamp(16px, 2vw, 26px) 0 64px }
    .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--gap-lg);}
    .card{ position:relative; overflow:hidden; border-radius: var(--radius);
      background: linear-gradient(180deg,#241115,#1a0f10); border:1px solid rgba(255,77,77,.16); box-shadow: var(--shadow);
      transform: translateY(6px); opacity:0; animation: fadeUp .55s cubic-bezier(.22,.61,.36,1) forwards;}
    .card:hover{ transform: translateY(-2px) scale(1.002); transition: transform .25s ease }
    .card .bar{ height:6px; background:linear-gradient(90deg, var(--accent), var(--accent-2));}
    .card .pad{ padding: 16px; display:grid; gap:10px }
    .kind{ display:inline-flex; gap:8px; align-items:center; color:#fff; background:linear-gradient(180deg,#3a161b,#2a0f12);
      border:1px solid rgba(255,77,77,.25); border-radius:999px; padding:6px 10px; width:max-content; font:600 12px/1 var(--sans); letter-spacing:.04em;}
    .name{ font: 700 16px/1.35 var(--sans); color:#fff; word-break: break-word;}
    .path{ font: 12px/1.5 var(--mono); color: var(--muted) }
    .desc{ font: 13px/1.6 var(--sans); color: #f2dede }
    .meta{ font: 12px/1.4 var(--mono); color: #e0c4c4; opacity:.9 }
    .icon{ width:16px; height:16px; display:inline-block; }
    .icon svg{ width:100%; height:100%; fill: currentColor }
    .empty, .loader{ color:var(--muted); text-align:center; padding: 32px 12px }
    .spinner{ width:28px; height:28px; border-radius:50%; border:3px solid rgba(255,77,77,.2);
      border-top-color: var(--accent-3); margin: 0 auto 10px; animation: spin 1s linear infinite;}
    footer{ color:var(--muted); border-top:1px solid rgba(255,77,77,.15);
      background:linear-gradient(180deg, rgba(26,15,16,.85), rgba(26,15,16,.6));}
    @keyframes fadeUp{ to{ transform: translateY(0); opacity:1 } }
    @keyframes spin{ to{ transform: rotate(360deg) } }
    @media (min-width: 860px){ .controls{ grid-template-columns: 1fr auto } }

    /* Botones */
    .links{ display:flex; gap:10px; flex-wrap:wrap }
    .links a{
      text-decoration:none; font:600 13px/1 var(--sans);
      padding:10px 12px; border-radius:999px;
      background: linear-gradient(180deg, #3f0f16, #2a0d11);
      border:1px solid rgba(255,77,77,.25);
      color:#fff; transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .links a:hover{ transform: translateY(-1px); box-shadow: 0 0 0 3px var(--ring), var(--shadow); border-color: var(--accent-3) }
    .pill{ font:600 11px/1 var(--sans); padding:6px 8px; border-radius:999px; border:1px solid rgba(255,77,77,.25);
      background:linear-gradient(180deg,#3a161b,#2a0f12); color:#fff; display:inline-flex; gap:6px; align-items:center}
    .ok{ color:#9cffb8 }
    .warn{ color:#ffd699 }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <span class="badge" aria-hidden="true">TSA</span>
        <h1>Índice del sitio publicado</h1>
      </div>
      <p class="sub">Abre directamente cada carpeta en su <code>index.html</code> publicado (GitHub Pages). También puedes ir al archivo/carpeta en GitHub o descargar el RAW.</p>
      <div class="controls" role="region" aria-label="Controles de búsqueda y filtros">
        <label class="search" aria-label="Buscar por nombre o ruta">
          <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20zM4 9.5C4 6.46 6.46 4 9.5 4S15 6.46 15 9.5 12.54 15 9.5 15 4 12.54 4 9.5"/></svg>
          <input id="q" type="search" placeholder="Buscar… (ej.: pdf, html, carotida, NIHSS, vasculitis)" autocomplete="off">
        </label>
        <div class="filters" role="group" aria-label="Filtros por tipo">
          <button class="chip" data-filter="dir" data-active="true">Directorios</button>
          <button class="chip" data-filter="html" data-active="true">HTML</button>
          <button class="chip" data-filter="css" data-active="true">CSS</button>
          <button class="chip" data-filter="js" data-active="true">JS</button>
          <button class="chip" data-filter="pdf" data-active="true">PDF</button>
          <button class="chip" data-filter="otros" data-active="true">Otros</button>
        </div>
        <div class="stats" id="stats" aria-live="polite"></div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="loader" class="loader">
        <div class="spinner" aria-hidden="true"></div>
        Cargando árbol de archivos…
      </div>
      <div id="grid" class="grid" hidden></div>
      <div id="empty" class="empty" hidden>No hay resultados para el filtro/búsqueda actual.</div>
    </div>
  </main>

  <footer>
    <div class="wrap" style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap">
      <div>Fuente: API pública de GitHub · <span style="color:#fff">rama <code style="color:#ffb3b3">main</code></span></div>
      <div>Enlaces principales → <span class="pill"><span>Publicado</span></span> · secundarios → <span class="pill"><span>GitHub</span></span> · <span class="pill"><span>RAW</span></span></div>
    </div>
  </footer>

  <template id="card-tpl">
    <article class="card" data-type="">
      <div class="bar" aria-hidden="true"></div>
      <div class="pad">
        <div class="kind"><span class="icon" aria-hidden="true"></span><span class="kind-text"></span></div>
        <div class="name"></div>
        <div class="path"></div>
        <div class="desc"></div>
        <div class="meta"></div>
        <div class="pub-flag"></div>
        <div class="links">
          <a class="btn-open" target="_self" rel="noopener">Abrir publicado</a>
          <a class="btn-gh" target="_blank" rel="noopener">GitHub</a>
          <a class="btn-raw" target="_blank" rel="noopener">RAW</a>
        </div>
      </div>
    </article>
  </template>

  <script>
    // === Config de tu repo ===
    const OWNER  = "rico100100";
    const REPO   = "TSA";
    const BRANCH = "main";

    const API     = `https://api.github.com/repos/${OWNER}/${REPO}/git/trees/${BRANCH}?recursive=1`;
    const GH_BLOB = (p)=> `https://github.com/${OWNER}/${REPO}/blob/${BRANCH}/${p}`;
    const GH_TREE = (p)=> `https://github.com/${OWNER}/${REPO}/tree/${BRANCH}/${p}`;
    const GH_RAW  = (p)=> `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${p}`;

    // Para el sitio publicado preferimos ENLACES RELATIVOS desde el index root.
    // Así funciona en GitHub Pages sin hardcodear dominios ni rutas.
    const PUBLISHED_HREF_DIR = (p)=> p.replace(/\/+$/,'') + "/";  // carpeta → "carpeta/"
    const PUBLISHED_HREF_FILE = (p)=> p;                           // archivo → "ruta/archivo.ext"

    const grid   = document.getElementById('grid');
    const tpl    = document.getElementById('card-tpl');
    const q      = document.getElementById('q');
    const loader = document.getElementById('loader');
    const empty  = document.getElementById('empty');
    const statsEl= document.getElementById('stats');

    const filters = new Set(['dir','html','css','js','pdf','otros']);
    document.querySelectorAll('.chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const f = btn.dataset.filter;
        const active = btn.getAttribute('data-active') === 'true';
        if(active){ btn.setAttribute('data-active','false'); filters.delete(f); }
        else { btn.setAttribute('data-active','true'); filters.add(f); }
        applyFilters();
      })
    });

    q.addEventListener('input', ()=> applyFilters());

    let NODES = []; // {type, path, name, kind, size, ext, desc, hrefs:{open, gh, raw}, hasIndex}

    // Carga el árbol de GitHub y prepara nodos con enlaces publicados
    fetch(API, {headers:{'Accept':'application/vnd.github+json'}})
      .then(r=>{
        if(!r.ok) throw new Error('GitHub API error: ' + r.status);
        return r.json();
      })
      .then(data=>{
        const tree = data.tree || [];

        // set con *todas* las rutas, para poder detectar carpetas con index.html
        const allPaths = new Set(tree.map(e => e.path));
        const dirsConIndex = new Set(
          [...allPaths]
            .filter(p => /\/index\.html?$/i.test(p))
            .map(p => p.replace(/\/index\.html?$/i, ''))
        );

        NODES = tree.map(en => {
          const isDir = en.type === 'tree';
          const path  = en.path;
          const name  = path.split('/').pop();
          const ext   = isDir ? '' : (name.includes('.') ? name.split('.').pop().toLowerCase() : '');
          const kind  = detectKind(isDir, ext);
          const size  = en.size || null;
          const desc  = simpleDesc({isDir, ext, name, path});
          const hasIndex = isDir ? dirsConIndex.has(path) : false;

          // enlaces
          const gh = isDir ? GH_TREE(path) : GH_BLOB(path);
          const raw= isDir ? '' : GH_RAW(path);

          let open = null;
          if(isDir && hasIndex){
            open = PUBLISHED_HREF_DIR(path);             // carpeta con index.html → "carpeta/"
          }else if(!isDir){
            // si es archivo visible en la web, lo abrimos directamente publicado
            const webExts = new Set(['html','htm','pdf','png','jpg','jpeg','gif','webp','svg','txt','json','csv']);
            if(webExts.has(ext)) open = PUBLISHED_HREF_FILE(path);
          }

          return { type: isDir ? 'dir':'file', path, name, ext, kind, size, desc, hasIndex,
                   hrefs: { open, gh, raw } };
        }).filter(Boolean);

        render(NODES);
      })
      .catch(err=>{
        loader.innerHTML = `<div class="spinner" aria-hidden="true"></div>Error cargando el árbol: ${err.message}`;
      });

    function detectKind(isDir, ext){
      if(isDir) return 'dir';
      if(['html','htm'].includes(ext)) return 'html';
      if(ext === 'css') return 'css';
      if(['js','mjs','cjs'].includes(ext)) return 'js';
      if(ext === 'pdf') return 'pdf';
      return 'otros';
    }

    function simpleDesc({isDir, ext, name, path}){
      const friendly = name.replace(/[-_]/g,' ').replace(/\.[^.]+$/,'')
        .replace(/\b([a-záéíóúñ])([a-záéíóúñ]*)/gi,(m,a,b)=>a.toUpperCase()+b.toLowerCase());
      if(isDir) return `Carpeta: ${friendly}.`;
      if(ext === 'html') return `Página HTML: ${friendly}.`;
      if(ext === 'css')  return `Hoja de estilos CSS.`;
      if(ext === 'js')   return `Script JavaScript.`;
      if(ext === 'pdf')  return `Documento PDF: ${friendly}.`;
      return `Archivo «${friendly}».`;
    }

    function iconFor(kind){
      const svg = {
        dir:  '<svg viewBox="0 0 24 24"><path d="M10 4H4a2 2 0 0 0-2 2v2h20V8a2 2 0 0 0-2-2h-8l-2-2Zm12 6H2v8a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-8Z"/></svg>',
        html: '<svg viewBox="0 0 24 24"><path d="M3 3h18v18H3z" opacity=".15"/><path d="M8 7 4 12l4 5M16 7l4 5-4 5"/></svg>',
        css:  '<svg viewBox="0 0 24 24"><path d="M4 3h16l-2 16-6 2-6-2L4 3Zm5 5h6l-.3 3H9.6l.2 2.1 3.9 1.1 2.1-.6.2 2.5L12 18l-4.5-1.5-.5-5.5L7 6h2Z"/></svg>',
        js:   '<svg viewBox="0 0 24 24"><path d="M3 3h18v18H3z" opacity=".15"/><path d="M8 17c0 1.7 1 2.8 3.1 2.8 1.3 0 2.3-.5 2.8-1.6l-1.8-.9c-.2.4-.5.6-1 .6-.6 0-1-.4-1-1.2V11H8v6Zm12-2.6c0-2-1.2-3-3.6-3-1.3 0-2.3.3-3 .9l1 1.6c.5-.3 1.1-.5 1.8-.5 1 .1 1.5.5 1.5 1.1 0 .5-.4.9-1.1 1.1l-.8.2c-1.7.5-2.6 1.4-2.6 2.7 0 1.7 1.3 2.7 3.4 2.7 1.5 0 2.6-.5 3.4-1.4l-1.2-1.5c-.5.5-1.1.7-1.8.7-.8 0-1.3-.3-1.3-.9 0-.5.4-.8 1.2-1.1l.8-.2c1.6-.4 2.3-1.3 2.3-2.9Z"/></svg>',
        pdf:  '<svg viewBox="0 0 24 24"><path d="M6 2h8l6 6v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z"/><path fill="#fff" d="M8 14h2.5a2 2 0 1 0 0-4H8v4Zm2-3a1 1 0 1 1 0 2H9v-2h1Zm3 3h1v-4h-1v4Zm2-3h2v-1h-3v4h1v-1h2v-1h-2v-1Z"/></svg>',
        otros:'<svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z"/><path d="M14 2v6h6"/></svg>'
      };
      return svg[kind] || svg.otros;
    }

    function humanSize(bytes){
      const u = ['B','KB','MB','GB']; let i=0; let n=bytes||0;
      while(n>=1024 && i<u.length-1){ n/=1024; i++; }
      return `${n.toFixed(n<10 && i>0 ? 1 : 0)} ${u[i]}`;
    }

    function render(list){
      loader.hidden = true; grid.hidden = false; grid.innerHTML = '';

      list.sort((a,b)=>{
        if(a.type !== b.type) return a.type === 'dir' ? -1 : 1;
        return a.path.localeCompare(b.path);
      });

      const frag = document.createDocumentFragment();
      list.forEach((node, i)=>{
        const card = tpl.content.firstElementChild.cloneNode(true);
        card.dataset.type = node.kind;
        card.querySelector('.icon').innerHTML = iconFor(node.kind);
        card.querySelector('.kind-text').textContent = node.type === 'dir' ? 'Directorio' : node.kind.toUpperCase();
        card.querySelector('.name').textContent = node.name;
        card.querySelector('.path').textContent = node.path;
        card.querySelector('.desc').textContent = node.desc;
        card.querySelector('.meta').textContent = node.type === 'dir'
          ? (node.hasIndex ? 'Carpeta con index.html' : 'Carpeta (sin index.html)')
          : (node.size ? `Tamaño aprox.: ${humanSize(node.size)}` : 'Archivo');

        // insignia publicado / no publicado
        const flag = card.querySelector('.pub-flag');
        if(node.type === 'dir'){
          flag.innerHTML = node.hasIndex
            ? '<span class="pill ok">Publicado</span>'
            : '<span class="pill warn">Sin index.html</span>';
        }else if(node.hrefs.open){
          flag.innerHTML = '<span class="pill ok">Publicado</span>';
        }else{
          flag.innerHTML = '<span class="pill warn">No visible directo</span>';
        }

        // enlaces
        const aOpen = card.querySelector('.btn-open');
        const aGH   = card.querySelector('.btn-gh');
        const aRaw  = card.querySelector('.btn-raw');

        aGH.href = node.type === 'dir' ? GH_TREE(node.path) : GH_BLOB(node.path);

        if(node.hrefs.open){
          aOpen.href = node.hrefs.open;
          aOpen.textContent = 'Abrir publicado';
          aOpen.hidden = false;
        }else{
          // si no hay versión publicada directa, mejor ocultar el botón
          aOpen.hidden = true;
        }

        if(node.type === 'file' && node.hrefs.raw){
          aRaw.href = node.hrefs.raw;
          aRaw.textContent = 'RAW';
          aRaw.hidden = false;
        }else{
          aRaw.hidden = true;
        }

        card.style.animationDelay = (i * 12) + 'ms';
        frag.appendChild(card);
      });
      grid.appendChild(frag);
      updateStats();
      applyFilters();
    }

    function applyFilters(){
      const query = (q.value || '').trim().toLowerCase();
      const active = new Set(filters);

      let shown = 0, total = 0;
      grid.querySelectorAll('.card').forEach(card=>{
        total++;
        const type = card.dataset.type || 'otros';
        const inFilter = active.has(type) || (type==='dir' && active.has('dir'));
        const text = (card.textContent || '').toLowerCase();
        const match = !query || text.includes(query);
        const visible = inFilter && match;
        card.style.display = visible ? '' : 'none';
        if(visible) shown++;
      });

      empty.hidden = shown !== 0;
      updateStats(shown, total);
    }

    function updateStats(shown, total){
      const all = NODES.length;
      const dirs = NODES.filter(n=>n.type==='dir').length;
      const files = all - dirs;
      const types = ['html','css','js','pdf','otros'].map(t=>[t, NODES.filter(n=>n.kind===t).length]);
      const visible = (shown ?? all);
      const tot = (total ?? all);
      statsEl.innerHTML = `
        <strong>${visible}</strong>/<span>${tot}</span> visibles ·
        <span>${dirs}</span> carpetas · <span>${files}</span> archivos ·
        ${types.map(([k,v])=> `${k.toUpperCase()}: <span>${v}</span>`).join(' · ')}
      `;
    }
  </script>
</body>
</html>
